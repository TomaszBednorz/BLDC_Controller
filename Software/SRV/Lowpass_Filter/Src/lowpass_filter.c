/***********************************************************************************************************
 ********************************************* Included files **********************************************
 ***********************************************************************************************************/

#include "lowpass_filter.h"

/***********************************************************************************************************
 ************************************************* Defines *************************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 *********************************************** Data types ************************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 **************************************** Local function prototypes ****************************************
 ***********************************************************************************************************/

static void Lowpass_Filter_1stOrderInit(LowpassFilter_1stStage_t *filter, float alpha);
static float Lowpass_Filter_1stOrderUpdate(LowpassFilter_1stStage_t *filter, float input);

/***********************************************************************************************************
 ******************************************** Exported objects *********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ********************************************* Local objects ***********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ******************************************* Exported functions ********************************************
 ***********************************************************************************************************/

void Lowpass_Filter_3rdOrderInit(LowpassFilter_3rdStage_t *filter, float alpha)
{
    Lowpass_Filter_1stOrderInit(&filter->stage1, alpha);
    Lowpass_Filter_1stOrderInit(&filter->stage2, alpha);
    Lowpass_Filter_1stOrderInit(&filter->stage3, alpha);
}

float Lowpass_Filter_3rdOrderUpdate(LowpassFilter_3rdStage_t *filter, float input)
{
    float output = Lowpass_Filter_1stOrderUpdate(&filter->stage1, input);
    output = Lowpass_Filter_1stOrderUpdate(&filter->stage2, output);
    output = Lowpass_Filter_1stOrderUpdate(&filter->stage3, output);
    return output;
}

/***********************************************************************************************************
 ******************************************** Local functions **********************************************
 ***********************************************************************************************************/

static void Lowpass_Filter_1stOrderInit(LowpassFilter_1stStage_t *filter, float alpha)
{
    filter->previous_output = 0.0f;
    filter->alpha = alpha;
}

static float Lowpass_Filter_1stOrderUpdate(LowpassFilter_1stStage_t *filter, float input)
{
    float output = filter->alpha * input + (1.0f - filter->alpha) * filter->previous_output;
    filter->previous_output = output;
    return output;
}