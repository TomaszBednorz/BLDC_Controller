/***********************************************************************************************************
 ********************************************* Included files **********************************************
 ***********************************************************************************************************/

#include "am4096_cfg.h"
#include "I2C_MASTER/i2c_master.h"

/***********************************************************************************************************
 ************************************************* Defines *************************************************
 ***********************************************************************************************************/

#define AM4096_TX_REG_IDX       (0U)
#define AM4096_TX_DATA_MSB_IDX  (1U)
#define AM4096_TX_DATA_LSB_IDX  (2U)
#define AM4096_TX_NBR           (3U)

#define AM4096_RX_DATA_MSB_IDX  (0U)
#define AM4096_RX_DATA_LSB_IDX  (1U)
#define AM4096_RX_NBR           (2U)


/***********************************************************************************************************
 *********************************************** Data types ************************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 **************************************** Local function prototypes ****************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ******************************************** Exported objects *********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ********************************************* Local objects ***********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ******************************************* Exported functions ********************************************
 ***********************************************************************************************************/

void Am4096_RegTx(uint8_t reg, uint16_t data)
{
    uint8_t tx_data[3];

    tx_data[AM4096_TX_REG_IDX] = reg;
    tx_data[AM4096_TX_DATA_MSB_IDX] = ((uint8_t*)&data)[1];
    tx_data[AM4096_TX_DATA_LSB_IDX] = ((uint8_t*)&data)[0];

	I2C_MASTER_Transmit(&I2C_ENC, true, AM4096_SLAVE_ID, tx_data, AM4096_TX_NBR, true);
	while(I2C_MASTER_IsTxBusy(&I2C_ENC));
}

uint16_t Am4096_RegRx(uint8_t reg)
{
    uint8_t rx_data[AM4096_RX_NBR];

	I2C_MASTER_Transmit(&I2C_ENC, true, AM4096_SLAVE_ID, &reg, 1U, false);
	while(I2C_MASTER_IsTxBusy(&I2C_ENC));

	I2C_MASTER_Receive(&I2C_ENC, true, AM4096_SLAVE_ID, rx_data, AM4096_RX_NBR, true, true);
	while(I2C_MASTER_IsRxBusy(&I2C_ENC));

    return (((uint16_t)rx_data[AM4096_RX_DATA_MSB_IDX] << 8U) | (uint16_t)rx_data[AM4096_RX_DATA_LSB_IDX]);
}

/***********************************************************************************************************
 ******************************************** Local functions **********************************************
 ***********************************************************************************************************/
